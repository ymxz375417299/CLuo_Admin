{% extends "myadmin/base.html" %} {# 引用#}
{% load static %}
{% block css %}{% static 'myadmin/css/home.css' %}{% endblock css %}
{% block title %} savecloud from text|CLuo工作室{%  endblock title %}
{% block home_active %}active{% endblock home_active %} {# 高亮#}


{% block content %}
<script type='text/javascript' src='{% static "myadmin/js/jquery-3.3.1.min.js" %}'></script>
<script type='text/javascript'>
  $(function(){
    // 初始化
    var account = $('#account');
    var cloud_text = $('#cloud_text');
    var btn = $('#psbtn');
    
    function submit_task(){
      // 提交ajax
      var account_v = account.val();
      var cloud_text_v = cloud_text.val();

      // 防跨站設置
      $.ajaxSetup({
        data: {csrfmiddlewaretoken: '{{ csrf_token }}' },  
      })

      //提交ajax
      $.ajax({
        url:"{% url 'myadmin:savecloud_from_text' %}", //提交到那里
        type:"POST", //提交类型
        data:{"account":account_v, "cloud_text":cloud_text_v}, //提交的数据
        datType: "text",
        success:function(data1){
          //返回完成进度\
          process_v = data1.info.process;//不加var 为全局变量
          if(process_v == 11){
            alert('结束')
          }
        }
      })

    }
    
    function check_task(){
      $.ajaxSetup({
        data: {csrfmiddlewaretoken: '{{ csrf_token }}'},
      })
      //提交
      $.ajax({
        url: "{% url 'myadmin:check_saveonecloud' %}",
        type:'GET',
        success: function(data1){
          alert(data1.info.process)
        },


      })
    }

    btn.click(function(){
      submit_task();
      var task1 = setInterval(check_task, 10000)

    })
  });
  

</script>


<form method='POST', id="savecloud_from_text">
{% csrf_token %}

    <div class="form-group">
      <label >保存网盘：</label>
      <input type="text" class="form-control" id="account" placeholder="网盘账号（格式：账号----密码----邮箱账号----密码）">
    </div>
    <div class="form-group">
    <textarea  class="form-control" id="cloud_text" rows="3"placeholder="解析的内容"></textarea></div>
    <div>
    <div class="form-group" >
    <div  class="form-control" id="control" title="控制台">
      <p>控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台控制台</p>
      <p>控制台</p>
      <p>控制台</p>
      <p>控制台</p>
    </div></div>
    <div>
    <button id="psbtn" type="button" class="btn btn-dark">运行</button>
    </div>

</form>
{% endblock content %}
